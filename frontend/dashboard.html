<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ - Server24</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">Server24</div>
            <div class="nav-menu">
                <a href="dashboard.html" class="nav-link active">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</a>
                <a href="buy.html" class="nav-link">Ø®Ø±ÛŒØ¯ Ø­Ø¬Ù…</a>
                <a href="wallet.html" class="nav-link">Ú©ÛŒÙ Ù¾ÙˆÙ„</a>
                <a href="profile.html" class="nav-link">Ù¾Ø±ÙˆÙØ§ÛŒÙ„</a>
                <a href="tickets.html" class="nav-link">Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ</a>
                <a href="#" id="logoutBtn" class="nav-link">Ø®Ø±ÙˆØ¬</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="page-header">
            <h1>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</h1>
            <p>Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ <span id="userName"></span></p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">ğŸ’°</div>
                <div class="stat-info">
                    <h3>Ù…ÙˆØ¬ÙˆØ¯ÛŒ</h3>
                    <p id="balance">0 ØªÙˆÙ…Ø§Ù†</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">ğŸ“Š</div>
                <div class="stat-info">
                    <h3>Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„</h3>
                    <p id="activeConfigs">0</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">ğŸ“ˆ</div>
                <div class="stat-info">
                    <h3>ØªØ±Ø§ÙÛŒÚ© Ù…ØµØ±ÙÛŒ</h3>
                    <p id="usedTraffic">0 GB</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ÛŒ Ù…Ù†</h2>
            <div id="configsList" class="configs-list">
                <p>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</p>
            </div>
        </div>
    </div>

    <script>
        // Ø¨Ø±Ø±Ø³ÛŒ Ù„Ø§Ú¯ÛŒÙ†
        const userStr = localStorage.getItem('user');
        if (!userStr) {
            window.location.href = 'login.html';
        }

        const user = JSON.parse(userStr);
        document.getElementById('userName').textContent = user.full_name || user.username || 'Ú©Ø§Ø±Ø¨Ø±';

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª
        async function loadDashboard() {
            try {
                const response = await fetch(`/api/users/${user.telegram_id}`);
                if (response.ok) {
                    const userData = await response.json();
                    
                    document.getElementById('balance').textContent = userData.balance.toLocaleString() + ' ØªÙˆÙ…Ø§Ù†';
                    document.getElementById('activeConfigs').textContent = userData.configs.filter(c => c.is_active).length;
                    
                    const totalUsed = userData.configs.reduce((sum, c) => sum + (c.used_gb || 0), 0);
                    document.getElementById('usedTraffic').textContent = totalUsed.toFixed(2) + ' GB';
                    
                    // Ù†Ù…Ø§ÛŒØ´ Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§
                    const configsList = document.getElementById('configsList');
                    if (userData.configs.length === 0) {
                        configsList.innerHTML = '<p>Ø´Ù…Ø§ Ù‡Ù†ÙˆØ² Ù‡ÛŒÚ† Ø³Ø±ÙˆÛŒØ³ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯. <a href="buy.html">Ø®Ø±ÛŒØ¯ Ø­Ø¬Ù…</a></p>';
                    } else {
                        configsList.innerHTML = userData.configs.map(config => `
                            <div class="config-card">
                                <div class="config-header">
                                    <h3>Ø³Ø±ÙˆÛŒØ³ ${config.id}</h3>
                                    <span class="status-badge ${config.is_active ? 'active' : 'inactive'}">
                                        ${config.is_active ? 'ÙØ¹Ø§Ù„' : 'ØºÛŒØ±ÙØ¹Ø§Ù„'}
                                    </span>
                                </div>
                                <div class="config-details">
                                    <p><strong>Ø­Ø¬Ù… Ú©Ù„:</strong> ${config.total_gb} GB</p>
                                    <p><strong>Ù…ØµØ±Ù Ø´Ø¯Ù‡:</strong> ${config.used_gb.toFixed(2)} GB</p>
                                    <p><strong>Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡:</strong> ${(config.total_gb - config.used_gb).toFixed(2)} GB</p>
                                    ${config.expire_date ? `<p><strong>ØªØ§Ø±ÛŒØ® Ø§Ù†Ù‚Ø¶Ø§:</strong> ${new Date(config.expire_date).toLocaleDateString('fa-IR')}</p>` : ''}
                                </div>
                            </div>
                        `).join('');
                    }
                }
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }

        loadDashboard();

        // Ø®Ø±ÙˆØ¬
        document.getElementById('logoutBtn').addEventListener('click', function() {
            localStorage.removeItem('user');
            window.location.href = 'login.html';
        });
    </script>
</body>
</html>

